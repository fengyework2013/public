<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta charset="utf-8">
		<!-- IE -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<!-- 设置 viewport -->
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- 兼容国产浏览器的高速模式 -->
		<meta name="renderer" content="webkit">
		<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
		<title>角色管理</title>

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
      <script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
		<!-- boots-->
		<link rel="stylesheet" type="text/css" href="../../lib/bootstrap-3.3.7-dist/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="../../css/commo.css" />
		<link rel="stylesheet" type="text/css" href="../../css/Vaildform.css" />
		<!--[if lt IE 8]>     
      <link rel="stylesheet" type="text/css" href="../../lib/lxui/css/lxui-ie6.min.css"/>
      <script src="../../lib/lxui/js/lxui-ie.min.js" type="text/javascript" charset="utf-8"></script>
    <![endif]-->
		<link rel="stylesheet" href="../../lib/zTree/css/metroStyle/metroStyle.css" type="text/css">
		<style type="text/css">
			.ztree li span.button.add {
				margin-left: 2px;
				margin-right: -1px;
				background-position: -144px 0;
				vertical-align: top;
				*vertical-align: middle
			}
		</style>
	</head>

	<body>
		<div class="container-fluid">
			<h1>角色管理</h1>
			<div class="zTreeDemoBackground left">
				<ul id="treeDemo" class="ztree"></ul>
				<div class="optionBox">
					<button type="button" class="sureCheck btn btn-default">确定</button>
				</div>
			</div>
		</div>

		<!--主要框架类库sss-->
		<script type="text/javascript" src="../../lib/jquery/1.9.1/jquery.min.js"></script>
		<script type="text/javascript" src="../../lib/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
		<!--<script src="../../lib/echarts/echarts.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../lib/echarts/bmap.min.js" type="text/javascript" charset="utf-8"></script><br />
		<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=8ZEtx5kDGsbBFL80Ppda29D8wjnGil7I"></script>-->
		<!--主要框架类库eee-->

		<!--公共脚本sss-->
		<script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/jquery.diy.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/jquery.cookie.js" type="text/javascript" charset="utf-8"></script>
		<!--公共脚本eee-->

		<!--常用插件sss-->
		<script src="../../lib/laypage/1.2/laypage.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../lib/layer/2.4/layer.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/jquery.nicescroll.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../lib/My97DatePicker/4.8/WdatePicker.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/Validform_v5.3.2_min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="../../lib/zTree/js/jquery.ztree.core.js"></script>
		<script type="text/javascript" src="../../lib/zTree/js/jquery.ztree.excheck.js"></script>
		<script type="text/javascript" src="../../lib/zTree/js/jquery.ztree.exedit.js"></script>
		<!--常用插件eee-->
		<SCRIPT type="text/javascript">
			var setting = {
				view: {
					addHoverDom: addHoverDom, //鼠标移动到节点或者获取节点的焦点的时候的回调
					removeHoverDom: removeHoverDom, //节点失去焦点的时候的回调
					selectedMulti: false
				},
				edit: {
					enable: true,
					editNameSelectAll: true,
					showRemoveBtn: showRemoveBtn, //删除的回调
					showRenameBtn: showRenameBtn //编辑的回调
				},
				check: {
//										enable: true //添加勾选功能
				},
				data: {
					simpleData: {
						enable: true
					}
				},
				callback: {					
					onClick: zTreeOnClick,
					beforeDrag: beforeDrag,
					beforeEditName: beforeEditName, //编辑节点之前的回调
					beforeRemove: beforeRemove, //删除节点之前的回调
					beforeRename: beforeRename,
					onRemove: onRemove, //删除节点
					onRename: onRename //编辑节点名字
				}
			};

			var zNodes = [{
					id: 1,
					pId: 0,
					name: "部门1",
					open: true
				},
				{
					id: 11,
					pId: 1,
					name: "部门1角色1-1"
				},
				{
					id: 12,
					pId: 1,
					name: "部门1角色 1-2"
				},
				{
					id: 13,
					pId: 1,
					name: "部门1角色 1-3"
				},
				{
					id: 2,
					pId: 0,
					name: "部门 2",
					open: true
				},
				{
					id: 21,
					pId: 2,
					name: "部门2角色2-1"
				},
				{
					id: 22,
					pId: 2,
					name: "部门2角色 2-2"
				},
				{
					id: 23,
					pId: 2,
					name: "部门2角色 2-3"
				},
				{
					id: 3,
					pId: 0,
					name: "部门 3",
					open: true
				},
				{
					id: 31,
					pId: 3,
					name: "部门3角色 3-1"
				},
				{
					id: 32,
					pId: 3,
					name: "部门3角色 3-2"
				},
				{
					id: 33,
					pId: 3,
					name: "部门3角色  3-3"
				}
			];
			var log, className = "dark";
			
			//获取树状节点
			var checkNode = {};
			function zTreeOnClick(event, treeId, treeNode) {				
				console.log(treeNode);
				checkNode.id = treeNode.id;
				checkNode.name = treeNode.name;
				checkNode.isParent = treeNode.isParent;
				
				$.cookie("roleInfo",JSON.stringify(checkNode));
				var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
				parent.layer.close(index);
			}
			
			//拖拽
			function beforeDrag(treeId, treeNodes) {
				return false;
			}
		
			function beforeEditName(treeId, treeNode) {
				className = (className === "dark" ? "" : "dark");
				showLog("[ " + getTime() + " beforeEditName ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name);
				var zTree = $.fn.zTree.getZTreeObj("treeDemo");
				zTree.selectNode(treeNode);
				setTimeout(function() {
					if(confirm("进入节点 -- " + treeNode.name + " 的编辑状态吗？")) {
						setTimeout(function() {
							zTree.editName(treeNode);
						}, 0);
					}
				}, 0);
				return false;
			}
			//删除节点之前的回调（请求后台，请求后台成功返回true，则可以删除）
			function beforeRemove(treeId, treeNode) {
				className = (className === "dark" ? "" : "dark");
				console.log(className);
				console.log("[ " + getTime() + " beforeRemove ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name);
				showLog("[ " + getTime() + " beforeRemove ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name);
				var zTree = $.fn.zTree.getZTreeObj("treeDemo");
				console.log(treeNode);
				zTree.selectNode(treeNode); //选择节点
				return confirm("确认删除 节点 -- " + treeNode.name + " 吗？");
			}
			//用于捕获删除节点之后的事件回调函数，如果用户设置了 beforeRemove 回调函数，并返回 false，将无法触发 onRemove 事件回调函数。
			function onRemove(e, treeId, treeNode) {
				//			showLog("[ "+getTime()+" onRemove ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name);
			}

			function beforeRename(treeId, treeNode, newName, isCancel) {
				className = (className === "dark" ? "" : "dark");
				console.log(newName);
				console.log(isCancel);
				showLog((isCancel ? "<span style='color:red'>" : "") + "[ " + getTime() + " beforeRename ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name + (isCancel ? "</span>" : ""));
				if(newName.length == 0) {
					setTimeout(function() {
						var zTree = $.fn.zTree.getZTreeObj("treeDemo");
						zTree.cancelEditName();
						alert("节点名称不能为空.");
					}, 0);
					return false;
				}
				return true;
			}

			function onRename(e, treeId, treeNode, isCancel) {
				console.log(isCancel);
				showLog((isCancel ? "<span style='color:red'>" : "") + "[ " + getTime() + " onRename ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name + (isCancel ? "</span>" : ""));
			}
			//返回布尔值，如果是第一个节点则返回false，否则true
			function showRemoveBtn(treeId, treeNode) {
				return !treeNode.isFirstNode;
			}
			//返回布尔值，如果是第一个节点则返回false，否则true
			function showRenameBtn(treeId, treeNode) {
				return !treeNode.isLastNode;
			}

			function showLog(str) {
				if(!log) log = $("#log");
				log.append("<li class='" + className + "'>" + str + "</li>");
				if(log.children("li").length > 8) {
					log.get(0).removeChild(log.children("li")[0]);
				}
			}

			function getTime() {
				var now = new Date(),
					h = now.getHours(),
					m = now.getMinutes(),
					s = now.getSeconds(),
					ms = now.getMilliseconds();
				return(h + ":" + m + ":" + s + " " + ms);
			}

			var newCount = 1;
			//添加节点功能
			function addHoverDom(treeId, treeNode) {
				//			console.log(treeId);//zTree的节点对象
				//			console.log(treeNode);
				var sObj = $("#" + treeNode.tId + "_span"); //当前子节点，tId指的是当前节点在全部父子节点加起来的个数中的排序值（排第几）
				if(treeNode.editNameFlag || $("#addBtn_" + treeNode.tId).length > 0) return; //如果存在添加按钮则返回
				var addStr = "<span class='button add' id='addBtn_" + treeNode.tId +
					"' title='add node' onfocus='this.blur();'></span>";
				sObj.after(addStr); //往子节点后面添加添加按钮
				var btn = $("#addBtn_" + treeNode.tId);
				if(btn) {
					btn.bind("click", function() {
						var zTree = $.fn.zTree.getZTreeObj("treeDemo"); //zTree v3.x 专门提供的根据 treeId 获取 zTree 对象的方法。（获取dom容器id）
						zTree.addNodes(
							treeNode, {
								id: (100 + newCount),
								pId: treeNode.id, //pId继承的是父节点的id（父id）
								name: "新节点" + (newCount++)
							}
						);
						return false;
					});
				}

			};

			//注销时间绑定，并且删除按钮
			function removeHoverDom(treeId, treeNode) {
				$("#addBtn_" + treeNode.tId).unbind().remove();
			};

			function selectAll() {
				var zTree = $.fn.zTree.getZTreeObj("treeDemo");
				zTree.setting.edit.editNameSelectAll = $("#selectAll").attr("checked");
			}

			$(document).ready(function() {
				$.fn.zTree.init($("#treeDemo"), setting, zNodes);
				$("#selectAll").bind("click", selectAll);
				
			});
			
			
			//勾选操作

			$(".sureCheck").click(function(){
//				console.log(aCheck);
			});
		</SCRIPT>
	</body>

</html>